<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>

  <h3>test steps:</h3>
  <ul>
    <li>accept receive message request</li>
    <li>browser receive request granted, FCM token shown in console.</li>
    <li>generate curl command to test send messaging to dedicated client/browser</li>
    <li>go issue command in local machine to test</li>
  </ul>

  <hr/>
  test token <br/>
<div class="test-token"></div>

  <hr/>
  test command <br />
<div class="test-command"></div>


  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>

  <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-messaging.js"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBnmrMAfoQvVRgXCIPG2wLiGO15s7u4bRY",
      authDomain: "fir-tryout-f4e7a.firebaseapp.com",
      databaseURL: "https://fir-tryout-f4e7a.firebaseio.com",
      projectId: "fir-tryout-f4e7a",
      storageBucket: "fir-tryout-f4e7a.appspot.com",
      messagingSenderId: "859668436628",
      appId: "1:859668436628:web:32fcc829845132db900681",
      measurementId: "G-Z001Y7HBM2"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();


    const messaging = firebase.messaging();
    messaging.requestPermission()
      .then(() => {
        console.log("have permission")
        return messaging.getToken()
      })
      .then((token)=> {

var test_command = `
  <pre style="width: 100%">
curl \
--header "Content-Type: application/json" \
--header "Authorization: key=$SERVER_KEY" https://fcm.googleapis.com/fcm/send \
-d '{"notification": {"body": "helloworld", "sound": "default"}, "priority": "high", "to": "${token}"}'
  </pre>`

        document.querySelector('.test-token').innerHTML=`<pre>${token}</pre>`

        console.log(token)
        document.querySelector('.test-command').innerHTML = test_command
      })
      .catch((err)=>{
        console.log('err no permission')
      })


    messaging.onMessaging((payLoad)=>{
      console.log("on messaging: ",payLoad)
    })
  </script>

</body>
</html>