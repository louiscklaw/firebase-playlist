function json_pretty_print (json_in) {
  return JSON.stringify( json_in, null, 2 );
}

function clear_select_list_option ( ele_in ) {
  _.range( ele_in.length ).forEach( idx => {
    ele_in.remove( 0 );
  })
}

var helloworld = 'helloworld';

const LOCAL_API_SERVER = 'http://localhost:5000/test-firebase-3a0f6/us-central1';

const API_SERVER = LOCAL_API_SERVER;

const API_PATH = `${API_SERVER}/main/api/jstest`;

const METHOD_POST = { method: 'POST' };
const METHOD_PUT = { method: 'PUT' };
const METHOD_DELETE = { method: 'DELETE' };
const HEADERS_JSON = { headers: { 'Content-Type': 'application/json' } };


function clickLogin () {
  alert( 'login clicked' );
}

function queryStatus () {
  alert( 'query Status clicked' );
}
function helloworld() {
  console.log( 'helloworld' );
}

const get_ele = ( sel_in ) => {
  return document.querySelector( sel_in )
};
const get_eles = ( sel_in ) => {
  return document.querySelectorAll( sel_in )
};

const prepare_get_request = ( endpoint ) => {
  return fetch( `${API_PATH}/${endpoint}` );
}

const prepare_put_request = ( endpoint ) => {
  return fetch( `${API_PATH}/${endpoint}`, create_json_put_config() );
}

function create_json_put_config( json_in ) {
  return {
    ...METHOD_PUT,
    ...HEADERS_JSON,
    body: JSON.stringify( json_in )
  };
}

const create_delete_config = ( ) => {
  return {
    ...METHOD_DELETE
  };
}

function create_json_post_config( json_in ) {
  return {
    ...METHOD_POST,
    ...HEADERS_JSON,
    body: JSON.stringify( json_in )
  };
}

function clickCreate() {
  fetch( `${API_PATH}/create_fight`, create_json_post_config( {
      winner: get_ele( '#create_winner' ).value,
      losser: get_ele( '#create_losser' ).value,
      title: get_ele( '#create_title' ).value
    } ) )
    .then( res => res.json() )
    .then( res_json => {
      refreshLists();
      get_ele( '#create_result' ).innerHTML = JSON.stringify( res_json );
    } )

}

function click_echo_get() {
  fetch( `${API_PATH}/echo_get?q=1234` )
    .then( res => res.text() )
    .then( res_text => {
      console.log( res_text )
      get_ele( '#echo_get' ).innerHTML = res_text;
    } )
}

function click_hello_get() {
  fetch( `${API_PATH}/hello_get` )
    .then( res => res.text() )
    .then( res_text => {
      console.log( res_text );
      get_ele( '#hello_get' ).innerHTML = res_text;
    } )
}

function click_list_all() {
  fetch( `${API_PATH}/fights` )
    .then( res => res.json() )
    .then( res_json => {
      get_ele( '#list_all_result' ).innerHTML = JSON.stringify( res_json );
    } )
}

function fetch_records() {
  return fetch( `${API_PATH}/fights` )
    .then( res => res.json() );
}

function prepareRecordList ( eles_in ) {

  fetch_records()
    .then( res_json => {
      eles_in.forEach( ele_in => {
        emptyList(ele_in);
        Object.keys( res_json ).forEach( _id => {
          var sel = ele_in;
          var opt1 = document.createElement( "option" );
          opt1.value = _id;
          opt1.text = _id;
          sel.add( opt1, null );
        } );
      })


    } )
}

function loadRecord( id_in ) {
  return prepare_get_request( `/fight/${id_in}` )
    .then( res => res.json() )

}

function readRecord( id_in ) {
  prepare_get_request( `/fight/${id_in}` )
    .then( res => res.json() )
    .then( res_json => {
      get_ele( '#read_winner' ).value = res_json.value.winner;
      get_ele( '#read_losser' ).value = res_json.value.losser;
      get_ele( '#read_title' ).value = res_json.value.title;
    } )
}

function onUpdateSelectChange( ele_in ) {
  var id_to_load = ele_in.value;
  loadRecord( id_to_load )
    .then( res_json => {
      get_ele( '#update_winner' ).value = res_json.value.winner;
      get_ele( '#update_losser' ).value = res_json.value.losser;
      get_ele( '#update_title' ).value = res_json.value.title;
    } )
}

function updateRecord() {
  var id_to_update = get_ele( '#update_records_list' ).value;
  var fetch_url = `${API_PATH}/fights/${id_to_update}`;
  console.log( fetch_url );

  fetch( fetch_url, create_json_put_config( {
      // winner: get_ele( '#update_winner' ).value,
      // losser: get_ele( '#update_losser' ).value,
      title: get_ele( '#update_title' ).value
    } ) )
    .then( res => res.json() )
    .then( res_json => {
      get_ele( '#update_records' ).innerHTML = JSON.stringify( res_json );
    } )
}

function deleteRecord () {
  let id = get_ele( '#delete_records_list' ).value;

  let fetch_url = `${API_PATH}/fights/${id}`;

  fetch(fetch_url , create_delete_config() )
  .then( res_json => {
    get_ele( '#update_records' ).innerHTML = JSON.stringify( res_json );
  } )
    .then( () => {
      refreshLists();
  })
}

function onReadSelectChange( ele_in ) {
  var id_to_read = ele_in.value;
  readRecord( id_to_read );
}

function emptyList ( ele_in ) {
  _.range( ele_in.options.length ).forEach( idx => {
    ele_in.remove( 0 );
  })

}

function refreshLists () {
  prepareRecordList( [
    get_ele( '#read_records_list' ),
    get_ele( '#update_records_list' ),
    get_ele( '#delete_records_list' )
  ] );
}

document.addEventListener( "DOMContentLoaded", function () {
  console.log( "helloworld" );

  refreshLists();
} );
function fetchUserList() {
  return fetch(`${API_PATH}/list_user`);
}

function fetch_to_json(uri, config = "") {
  if (config == "") {
    return fetch(uri).then(res => res.json());
  } else {
    return fetch(uri, config).then(res => res.json());
  }
}

function clickDeleteUser() {
  let id_to_delete = get_ele("#delete_user_list").value;
  fetch_to_json(`${API_PATH}/user/${id_to_delete}`, create_delete_config())
    .then(res_json => {
      get_ele("#delete_user_result").innerHTML = json_pretty_print(res_json);
    })
    .then( () => { updateUserList(); });
}

function clickListUser() {
  fetchUserList()
    .then(res => res.json())
    .then(res_json => {
      get_ele("#list_user_result").innerHTML = json_pretty_print(res_json);
    });
}

function insert_into_user_delete(ele_in, text, value) {
  ele_in.appendChild(new Option(text, value));
}

function insert_into_user_update(ele_in, text, value) {
  ele_in.appendChild(new Option(text, value));
}

function updateUserList() {
  fetchUserList()
    .then( res => res.json() )
    .then( res_json => {
      clear_select_list_option( get_ele( '#delete_user_list' ) );
      clear_select_list_option( get_ele( '#update_user_list' ) );
      return res_json;
    })
    .then(res_json => {
      let ele_delete_user_list = get_ele("#delete_user_list");
      let ele_update_user_list = get_ele("#update_user_list");
      Object.keys(res_json).forEach(_id => {
        insert_into_user_delete(ele_delete_user_list, _id, _id);
        insert_into_user_update(ele_update_user_list, _id, _id);
      } );

    });
}

document.addEventListener("DOMContentLoaded", function() {
  updateUserList();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9jb21tb24uanMiLCJfdmFycy5qcyIsImxvZ2luLmpzIiwibWFpbi5qcyIsInVzZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBqc29uX3ByZXR0eV9wcmludCAoanNvbl9pbikge1xuICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoIGpzb25faW4sIG51bGwsIDIgKTtcbn1cblxuZnVuY3Rpb24gY2xlYXJfc2VsZWN0X2xpc3Rfb3B0aW9uICggZWxlX2luICkge1xuICBfLnJhbmdlKCBlbGVfaW4ubGVuZ3RoICkuZm9yRWFjaCggaWR4ID0+IHtcbiAgICBlbGVfaW4ucmVtb3ZlKCAwICk7XG4gIH0pXG59IiwiXG52YXIgaGVsbG93b3JsZCA9ICdoZWxsb3dvcmxkJztcblxuY29uc3QgTE9DQUxfQVBJX1NFUlZFUiA9ICdodHRwOi8vbG9jYWxob3N0OjUwMDAvdGVzdC1maXJlYmFzZS0zYTBmNi91cy1jZW50cmFsMSc7XG5cbmNvbnN0IEFQSV9TRVJWRVIgPSBMT0NBTF9BUElfU0VSVkVSO1xuXG5jb25zdCBBUElfUEFUSCA9IGAke0FQSV9TRVJWRVJ9L21haW4vYXBpL2pzdGVzdGA7XG5cbmNvbnN0IE1FVEhPRF9QT1NUID0geyBtZXRob2Q6ICdQT1NUJyB9O1xuY29uc3QgTUVUSE9EX1BVVCA9IHsgbWV0aG9kOiAnUFVUJyB9O1xuY29uc3QgTUVUSE9EX0RFTEVURSA9IHsgbWV0aG9kOiAnREVMRVRFJyB9O1xuY29uc3QgSEVBREVSU19KU09OID0geyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSB9O1xuIiwiXG5mdW5jdGlvbiBjbGlja0xvZ2luICgpIHtcbiAgYWxlcnQoICdsb2dpbiBjbGlja2VkJyApO1xufVxuXG5mdW5jdGlvbiBxdWVyeVN0YXR1cyAoKSB7XG4gIGFsZXJ0KCAncXVlcnkgU3RhdHVzIGNsaWNrZWQnICk7XG59IiwiZnVuY3Rpb24gaGVsbG93b3JsZCgpIHtcbiAgY29uc29sZS5sb2coICdoZWxsb3dvcmxkJyApO1xufVxuXG5jb25zdCBnZXRfZWxlID0gKCBzZWxfaW4gKSA9PiB7XG4gIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxfaW4gKVxufTtcbmNvbnN0IGdldF9lbGVzID0gKCBzZWxfaW4gKSA9PiB7XG4gIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCBzZWxfaW4gKVxufTtcblxuY29uc3QgcHJlcGFyZV9nZXRfcmVxdWVzdCA9ICggZW5kcG9pbnQgKSA9PiB7XG4gIHJldHVybiBmZXRjaCggYCR7QVBJX1BBVEh9LyR7ZW5kcG9pbnR9YCApO1xufVxuXG5jb25zdCBwcmVwYXJlX3B1dF9yZXF1ZXN0ID0gKCBlbmRwb2ludCApID0+IHtcbiAgcmV0dXJuIGZldGNoKCBgJHtBUElfUEFUSH0vJHtlbmRwb2ludH1gLCBjcmVhdGVfanNvbl9wdXRfY29uZmlnKCkgKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlX2pzb25fcHV0X2NvbmZpZygganNvbl9pbiApIHtcbiAgcmV0dXJuIHtcbiAgICAuLi5NRVRIT0RfUFVULFxuICAgIC4uLkhFQURFUlNfSlNPTixcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSgganNvbl9pbiApXG4gIH07XG59XG5cbmNvbnN0IGNyZWF0ZV9kZWxldGVfY29uZmlnID0gKCApID0+IHtcbiAgcmV0dXJuIHtcbiAgICAuLi5NRVRIT0RfREVMRVRFXG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZV9qc29uX3Bvc3RfY29uZmlnKCBqc29uX2luICkge1xuICByZXR1cm4ge1xuICAgIC4uLk1FVEhPRF9QT1NULFxuICAgIC4uLkhFQURFUlNfSlNPTixcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSgganNvbl9pbiApXG4gIH07XG59XG5cbmZ1bmN0aW9uIGNsaWNrQ3JlYXRlKCkge1xuICBmZXRjaCggYCR7QVBJX1BBVEh9L2NyZWF0ZV9maWdodGAsIGNyZWF0ZV9qc29uX3Bvc3RfY29uZmlnKCB7XG4gICAgICB3aW5uZXI6IGdldF9lbGUoICcjY3JlYXRlX3dpbm5lcicgKS52YWx1ZSxcbiAgICAgIGxvc3NlcjogZ2V0X2VsZSggJyNjcmVhdGVfbG9zc2VyJyApLnZhbHVlLFxuICAgICAgdGl0bGU6IGdldF9lbGUoICcjY3JlYXRlX3RpdGxlJyApLnZhbHVlXG4gICAgfSApIClcbiAgICAudGhlbiggcmVzID0+IHJlcy5qc29uKCkgKVxuICAgIC50aGVuKCByZXNfanNvbiA9PiB7XG4gICAgICByZWZyZXNoTGlzdHMoKTtcbiAgICAgIGdldF9lbGUoICcjY3JlYXRlX3Jlc3VsdCcgKS5pbm5lckhUTUwgPSBKU09OLnN0cmluZ2lmeSggcmVzX2pzb24gKTtcbiAgICB9IClcblxufVxuXG5mdW5jdGlvbiBjbGlja19lY2hvX2dldCgpIHtcbiAgZmV0Y2goIGAke0FQSV9QQVRIfS9lY2hvX2dldD9xPTEyMzRgIClcbiAgICAudGhlbiggcmVzID0+IHJlcy50ZXh0KCkgKVxuICAgIC50aGVuKCByZXNfdGV4dCA9PiB7XG4gICAgICBjb25zb2xlLmxvZyggcmVzX3RleHQgKVxuICAgICAgZ2V0X2VsZSggJyNlY2hvX2dldCcgKS5pbm5lckhUTUwgPSByZXNfdGV4dDtcbiAgICB9IClcbn1cblxuZnVuY3Rpb24gY2xpY2tfaGVsbG9fZ2V0KCkge1xuICBmZXRjaCggYCR7QVBJX1BBVEh9L2hlbGxvX2dldGAgKVxuICAgIC50aGVuKCByZXMgPT4gcmVzLnRleHQoKSApXG4gICAgLnRoZW4oIHJlc190ZXh0ID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCByZXNfdGV4dCApO1xuICAgICAgZ2V0X2VsZSggJyNoZWxsb19nZXQnICkuaW5uZXJIVE1MID0gcmVzX3RleHQ7XG4gICAgfSApXG59XG5cbmZ1bmN0aW9uIGNsaWNrX2xpc3RfYWxsKCkge1xuICBmZXRjaCggYCR7QVBJX1BBVEh9L2ZpZ2h0c2AgKVxuICAgIC50aGVuKCByZXMgPT4gcmVzLmpzb24oKSApXG4gICAgLnRoZW4oIHJlc19qc29uID0+IHtcbiAgICAgIGdldF9lbGUoICcjbGlzdF9hbGxfcmVzdWx0JyApLmlubmVySFRNTCA9IEpTT04uc3RyaW5naWZ5KCByZXNfanNvbiApO1xuICAgIH0gKVxufVxuXG5mdW5jdGlvbiBmZXRjaF9yZWNvcmRzKCkge1xuICByZXR1cm4gZmV0Y2goIGAke0FQSV9QQVRIfS9maWdodHNgIClcbiAgICAudGhlbiggcmVzID0+IHJlcy5qc29uKCkgKTtcbn1cblxuZnVuY3Rpb24gcHJlcGFyZVJlY29yZExpc3QgKCBlbGVzX2luICkge1xuXG4gIGZldGNoX3JlY29yZHMoKVxuICAgIC50aGVuKCByZXNfanNvbiA9PiB7XG4gICAgICBlbGVzX2luLmZvckVhY2goIGVsZV9pbiA9PiB7XG4gICAgICAgIGVtcHR5TGlzdChlbGVfaW4pO1xuICAgICAgICBPYmplY3Qua2V5cyggcmVzX2pzb24gKS5mb3JFYWNoKCBfaWQgPT4ge1xuICAgICAgICAgIHZhciBzZWwgPSBlbGVfaW47XG4gICAgICAgICAgdmFyIG9wdDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBcIm9wdGlvblwiICk7XG4gICAgICAgICAgb3B0MS52YWx1ZSA9IF9pZDtcbiAgICAgICAgICBvcHQxLnRleHQgPSBfaWQ7XG4gICAgICAgICAgc2VsLmFkZCggb3B0MSwgbnVsbCApO1xuICAgICAgICB9ICk7XG4gICAgICB9KVxuXG5cbiAgICB9IClcbn1cblxuZnVuY3Rpb24gbG9hZFJlY29yZCggaWRfaW4gKSB7XG4gIHJldHVybiBwcmVwYXJlX2dldF9yZXF1ZXN0KCBgL2ZpZ2h0LyR7aWRfaW59YCApXG4gICAgLnRoZW4oIHJlcyA9PiByZXMuanNvbigpIClcblxufVxuXG5mdW5jdGlvbiByZWFkUmVjb3JkKCBpZF9pbiApIHtcbiAgcHJlcGFyZV9nZXRfcmVxdWVzdCggYC9maWdodC8ke2lkX2lufWAgKVxuICAgIC50aGVuKCByZXMgPT4gcmVzLmpzb24oKSApXG4gICAgLnRoZW4oIHJlc19qc29uID0+IHtcbiAgICAgIGdldF9lbGUoICcjcmVhZF93aW5uZXInICkudmFsdWUgPSByZXNfanNvbi52YWx1ZS53aW5uZXI7XG4gICAgICBnZXRfZWxlKCAnI3JlYWRfbG9zc2VyJyApLnZhbHVlID0gcmVzX2pzb24udmFsdWUubG9zc2VyO1xuICAgICAgZ2V0X2VsZSggJyNyZWFkX3RpdGxlJyApLnZhbHVlID0gcmVzX2pzb24udmFsdWUudGl0bGU7XG4gICAgfSApXG59XG5cbmZ1bmN0aW9uIG9uVXBkYXRlU2VsZWN0Q2hhbmdlKCBlbGVfaW4gKSB7XG4gIHZhciBpZF90b19sb2FkID0gZWxlX2luLnZhbHVlO1xuICBsb2FkUmVjb3JkKCBpZF90b19sb2FkIClcbiAgICAudGhlbiggcmVzX2pzb24gPT4ge1xuICAgICAgZ2V0X2VsZSggJyN1cGRhdGVfd2lubmVyJyApLnZhbHVlID0gcmVzX2pzb24udmFsdWUud2lubmVyO1xuICAgICAgZ2V0X2VsZSggJyN1cGRhdGVfbG9zc2VyJyApLnZhbHVlID0gcmVzX2pzb24udmFsdWUubG9zc2VyO1xuICAgICAgZ2V0X2VsZSggJyN1cGRhdGVfdGl0bGUnICkudmFsdWUgPSByZXNfanNvbi52YWx1ZS50aXRsZTtcbiAgICB9IClcbn1cblxuZnVuY3Rpb24gdXBkYXRlUmVjb3JkKCkge1xuICB2YXIgaWRfdG9fdXBkYXRlID0gZ2V0X2VsZSggJyN1cGRhdGVfcmVjb3Jkc19saXN0JyApLnZhbHVlO1xuICB2YXIgZmV0Y2hfdXJsID0gYCR7QVBJX1BBVEh9L2ZpZ2h0cy8ke2lkX3RvX3VwZGF0ZX1gO1xuICBjb25zb2xlLmxvZyggZmV0Y2hfdXJsICk7XG5cbiAgZmV0Y2goIGZldGNoX3VybCwgY3JlYXRlX2pzb25fcHV0X2NvbmZpZygge1xuICAgICAgLy8gd2lubmVyOiBnZXRfZWxlKCAnI3VwZGF0ZV93aW5uZXInICkudmFsdWUsXG4gICAgICAvLyBsb3NzZXI6IGdldF9lbGUoICcjdXBkYXRlX2xvc3NlcicgKS52YWx1ZSxcbiAgICAgIHRpdGxlOiBnZXRfZWxlKCAnI3VwZGF0ZV90aXRsZScgKS52YWx1ZVxuICAgIH0gKSApXG4gICAgLnRoZW4oIHJlcyA9PiByZXMuanNvbigpIClcbiAgICAudGhlbiggcmVzX2pzb24gPT4ge1xuICAgICAgZ2V0X2VsZSggJyN1cGRhdGVfcmVjb3JkcycgKS5pbm5lckhUTUwgPSBKU09OLnN0cmluZ2lmeSggcmVzX2pzb24gKTtcbiAgICB9IClcbn1cblxuZnVuY3Rpb24gZGVsZXRlUmVjb3JkICgpIHtcbiAgbGV0IGlkID0gZ2V0X2VsZSggJyNkZWxldGVfcmVjb3Jkc19saXN0JyApLnZhbHVlO1xuXG4gIGxldCBmZXRjaF91cmwgPSBgJHtBUElfUEFUSH0vZmlnaHRzLyR7aWR9YDtcblxuICBmZXRjaChmZXRjaF91cmwgLCBjcmVhdGVfZGVsZXRlX2NvbmZpZygpIClcbiAgLnRoZW4oIHJlc19qc29uID0+IHtcbiAgICBnZXRfZWxlKCAnI3VwZGF0ZV9yZWNvcmRzJyApLmlubmVySFRNTCA9IEpTT04uc3RyaW5naWZ5KCByZXNfanNvbiApO1xuICB9IClcbiAgICAudGhlbiggKCkgPT4ge1xuICAgICAgcmVmcmVzaExpc3RzKCk7XG4gIH0pXG59XG5cbmZ1bmN0aW9uIG9uUmVhZFNlbGVjdENoYW5nZSggZWxlX2luICkge1xuICB2YXIgaWRfdG9fcmVhZCA9IGVsZV9pbi52YWx1ZTtcbiAgcmVhZFJlY29yZCggaWRfdG9fcmVhZCApO1xufVxuXG5mdW5jdGlvbiBlbXB0eUxpc3QgKCBlbGVfaW4gKSB7XG4gIF8ucmFuZ2UoIGVsZV9pbi5vcHRpb25zLmxlbmd0aCApLmZvckVhY2goIGlkeCA9PiB7XG4gICAgZWxlX2luLnJlbW92ZSggMCApO1xuICB9KVxuXG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hMaXN0cyAoKSB7XG4gIHByZXBhcmVSZWNvcmRMaXN0KCBbXG4gICAgZ2V0X2VsZSggJyNyZWFkX3JlY29yZHNfbGlzdCcgKSxcbiAgICBnZXRfZWxlKCAnI3VwZGF0ZV9yZWNvcmRzX2xpc3QnICksXG4gICAgZ2V0X2VsZSggJyNkZWxldGVfcmVjb3Jkc19saXN0JyApXG4gIF0gKTtcbn1cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgY29uc29sZS5sb2coIFwiaGVsbG93b3JsZFwiICk7XG5cbiAgcmVmcmVzaExpc3RzKCk7XG59ICk7IiwiZnVuY3Rpb24gZmV0Y2hVc2VyTGlzdCgpIHtcbiAgcmV0dXJuIGZldGNoKGAke0FQSV9QQVRIfS9saXN0X3VzZXJgKTtcbn1cblxuZnVuY3Rpb24gZmV0Y2hfdG9fanNvbih1cmksIGNvbmZpZyA9IFwiXCIpIHtcbiAgaWYgKGNvbmZpZyA9PSBcIlwiKSB7XG4gICAgcmV0dXJuIGZldGNoKHVyaSkudGhlbihyZXMgPT4gcmVzLmpzb24oKSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZldGNoKHVyaSwgY29uZmlnKS50aGVuKHJlcyA9PiByZXMuanNvbigpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjbGlja0RlbGV0ZVVzZXIoKSB7XG4gIGxldCBpZF90b19kZWxldGUgPSBnZXRfZWxlKFwiI2RlbGV0ZV91c2VyX2xpc3RcIikudmFsdWU7XG4gIGZldGNoX3RvX2pzb24oYCR7QVBJX1BBVEh9L3VzZXIvJHtpZF90b19kZWxldGV9YCwgY3JlYXRlX2RlbGV0ZV9jb25maWcoKSlcbiAgICAudGhlbihyZXNfanNvbiA9PiB7XG4gICAgICBnZXRfZWxlKFwiI2RlbGV0ZV91c2VyX3Jlc3VsdFwiKS5pbm5lckhUTUwgPSBqc29uX3ByZXR0eV9wcmludChyZXNfanNvbik7XG4gICAgfSlcbiAgICAudGhlbiggKCkgPT4geyB1cGRhdGVVc2VyTGlzdCgpOyB9KTtcbn1cblxuZnVuY3Rpb24gY2xpY2tMaXN0VXNlcigpIHtcbiAgZmV0Y2hVc2VyTGlzdCgpXG4gICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG4gICAgLnRoZW4ocmVzX2pzb24gPT4ge1xuICAgICAgZ2V0X2VsZShcIiNsaXN0X3VzZXJfcmVzdWx0XCIpLmlubmVySFRNTCA9IGpzb25fcHJldHR5X3ByaW50KHJlc19qc29uKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaW5zZXJ0X2ludG9fdXNlcl9kZWxldGUoZWxlX2luLCB0ZXh0LCB2YWx1ZSkge1xuICBlbGVfaW4uYXBwZW5kQ2hpbGQobmV3IE9wdGlvbih0ZXh0LCB2YWx1ZSkpO1xufVxuXG5mdW5jdGlvbiBpbnNlcnRfaW50b191c2VyX3VwZGF0ZShlbGVfaW4sIHRleHQsIHZhbHVlKSB7XG4gIGVsZV9pbi5hcHBlbmRDaGlsZChuZXcgT3B0aW9uKHRleHQsIHZhbHVlKSk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVVzZXJMaXN0KCkge1xuICBmZXRjaFVzZXJMaXN0KClcbiAgICAudGhlbiggcmVzID0+IHJlcy5qc29uKCkgKVxuICAgIC50aGVuKCByZXNfanNvbiA9PiB7XG4gICAgICBjbGVhcl9zZWxlY3RfbGlzdF9vcHRpb24oIGdldF9lbGUoICcjZGVsZXRlX3VzZXJfbGlzdCcgKSApO1xuICAgICAgY2xlYXJfc2VsZWN0X2xpc3Rfb3B0aW9uKCBnZXRfZWxlKCAnI3VwZGF0ZV91c2VyX2xpc3QnICkgKTtcbiAgICAgIHJldHVybiByZXNfanNvbjtcbiAgICB9KVxuICAgIC50aGVuKHJlc19qc29uID0+IHtcbiAgICAgIGxldCBlbGVfZGVsZXRlX3VzZXJfbGlzdCA9IGdldF9lbGUoXCIjZGVsZXRlX3VzZXJfbGlzdFwiKTtcbiAgICAgIGxldCBlbGVfdXBkYXRlX3VzZXJfbGlzdCA9IGdldF9lbGUoXCIjdXBkYXRlX3VzZXJfbGlzdFwiKTtcbiAgICAgIE9iamVjdC5rZXlzKHJlc19qc29uKS5mb3JFYWNoKF9pZCA9PiB7XG4gICAgICAgIGluc2VydF9pbnRvX3VzZXJfZGVsZXRlKGVsZV9kZWxldGVfdXNlcl9saXN0LCBfaWQsIF9pZCk7XG4gICAgICAgIGluc2VydF9pbnRvX3VzZXJfdXBkYXRlKGVsZV91cGRhdGVfdXNlcl9saXN0LCBfaWQsIF9pZCk7XG4gICAgICB9ICk7XG5cbiAgICB9KTtcbn1cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24oKSB7XG4gIHVwZGF0ZVVzZXJMaXN0KCk7XG59KTtcbiJdfQ==
